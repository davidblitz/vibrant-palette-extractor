<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<!-- Start bootstrap -->
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!--end bootstrap-->

<script src="lib/Vibrant.min.js"></script>
<script src="lib/svg.js"></script>
<body>
  <div class="row">
    <div class="col-sm-8">
    <div id="imageDisplay"></div>
    </div>
    <div class="col-sm-4">
      <div id="colorDisplay"></div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-8">
    </div>
    <div class="col-sm-4">
      <label class="btn btn-default btn-file" background-color=#4CAF50 onchange="openFile(event)">
      Load Image <input type="file" style="display: none;">
      </label>
    </div>
  </div>


</body>
<script>
var img = document.createElement('img');
img.setAttribute('src', 'img/analyze.jpg')

var openFile = function(event) {
  var input = event.target;
  var file    = input.files[0]; //sames as here
  var reader  = new FileReader();

  reader.onloadend = function () {
    img.src = reader.result;
  }

  if (file) {
    reader.readAsDataURL(file); //reads the data as a URL
  } else {
    img.src = "img/analyze.jpg";
  }
};


img.width = 600
img.height = 400

var imageDisplay = document.getElementById('imageDisplay')
                          .appendChild(img)

img.addEventListener('load', function() {
    var vibrant = new Vibrant(img, 128, 5);
    var swatches = vibrant.swatches()
    for (var swatch in swatches) {
      if (swatches.hasOwnProperty(swatch) && swatches[swatch]) {
          console.log(swatch, swatches[swatch].getRgb())
        }
    }
    /*
    var img2 = new Image();
    img2.setAttribute('src', 'example.jpg')
    var canvas = document.getElementById('canvas')
    var context = canvas.getContext('2d')
    canvas.width = 400
    canvas.height = 300
    context.drawImage(img2, 0, 0, canvas.width, canvas.height)
    imageData = context.getImageData(0, 0, canvas.width, canvas.height)
    pixels = imageData.data
    console.log(pixels.length)

    function euclidean(rgb1, rgb2) {
      return Math.sqrt(Math.pow(rgb1[0] - rgb2[0], 2) + Math.pow(rgb1[1] - rgb2[1], 2) + Math.pow(rgb1[2] - rgb2[2], 2))
    }

    function closestSwatch(rgb) {
      var closest = []
      var mn = 1000*1000
      for( var swatch in swatches) {
        if (swatches.hasOwnProperty(swatch) && swatches[swatch]) {
          var swatch_rgb = swatches[swatch].getRgb()
          var dist = euclidean(swatch_rgb, rgb)
          if(dist < mn) {
            closest = swatch
            mn = dist
          }
        }
      }

      return closest
    }

    for(var i=0; i<pixels.length; i += 4) {
      var rgb = [pixels[i], pixels[i+1], pixels[i+2]]

      var newRgb = swatches[closestSwatch(rgb)].getRgb()

      imageData.data[i] = newRgb[0]
      imageData.data[i+1] = newRgb[1]
      imageData.data[i+2] = newRgb[2]
    }

    context.putImageData(imageData, 0, 0)
    */
    //display prominent colors
    var colorInd = 0
    var xStep = 200
    var colorDisplay = document.getElementById("colorDisplay")
    while (colorDisplay.hasChildNodes()) {
      colorDisplay.removeChild(colorDisplay.lastChild)
    }
    
    for( var swatch in swatches) {
      if (swatches.hasOwnProperty(swatch) && swatches[swatch]) {
        //var color = colorDisplay.appendChild(document.createElement(swatch))
        var text = document.createElement('div')
        text.class = "row"
        colorDisplay.appendChild(text)
        var display = document.createElement('div')
        display.class = "row"
        colorDisplay.appendChild(display)
        text.innerHTML = text.innerHTML + swatch + ": " + swatches[swatch].getHex() + " "

        var draw = SVG(display).size(70, 70)
        draw.rect(50, 50).fill(swatches[swatch].getHex()).move(10, 10)
        colorInd += 1
      }
    }
});
</script>
</html>

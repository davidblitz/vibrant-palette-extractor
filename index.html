<html>
<meta charset="utf-8">
<script src="Vibrant.min.js"></script>
<script src="svg.js"></script>
<body>
  <div id="colorDisplay" class="columns"></div>
</body>
<script>

var img = document.createElement('img');
img.setAttribute('src', 'analyze.jpg')

img.addEventListener('load', function() {
    var vibrant = new Vibrant(img, 128, 5);
    var swatches = vibrant.swatches()
    for (var swatch in swatches) {
      if (swatches.hasOwnProperty(swatch) && swatches[swatch]) {
          console.log(swatch, swatches[swatch].getRgb())
        }
    }
    /*
    var img2 = new Image();
    img2.setAttribute('src', 'example.jpg')
    var canvas = document.getElementById('canvas')
    var context = canvas.getContext('2d')
    canvas.width = 400
    canvas.height = 300
    context.drawImage(img2, 0, 0, canvas.width, canvas.height)
    imageData = context.getImageData(0, 0, canvas.width, canvas.height)
    pixels = imageData.data
    console.log(pixels.length)

    function euclidean(rgb1, rgb2) {
      return Math.sqrt(Math.pow(rgb1[0] - rgb2[0], 2) + Math.pow(rgb1[1] - rgb2[1], 2) + Math.pow(rgb1[2] - rgb2[2], 2))
    }

    function closestSwatch(rgb) {
      var closest = []
      var mn = 1000*1000
      for( var swatch in swatches) {
        if (swatches.hasOwnProperty(swatch) && swatches[swatch]) {
          var swatch_rgb = swatches[swatch].getRgb()
          var dist = euclidean(swatch_rgb, rgb)
          if(dist < mn) {
            closest = swatch
            mn = dist
          }
        }
      }

      return closest
    }

    for(var i=0; i<pixels.length; i += 4) {
      var rgb = [pixels[i], pixels[i+1], pixels[i+2]]

      var newRgb = swatches[closestSwatch(rgb)].getRgb()

      imageData.data[i] = newRgb[0]
      imageData.data[i+1] = newRgb[1]
      imageData.data[i+2] = newRgb[2]
    }

    context.putImageData(imageData, 0, 0)
    */
    //display prominent colors
    var colorInd = 0
    var xStep = 200
    var colorDisplay = document.getElementById("colorDisplay")
    var text = colorDisplay.appendChild(document.createElement('div'))
    var display = colorDisplay.appendChild(document.createElement('div'))
    display.width = 5*xStep
    display.height = 50 + 10
    var draw = SVG(display)
    for( var swatch in swatches) {
      if (swatches.hasOwnProperty(swatch) && swatches[swatch]) {
        //var color = colorDisplay.appendChild(document.createElement(swatch))
        text.innerHTML = text.innerHTML + swatch + ": " + swatches[swatch].getHex() + " "
        draw.rect(50, 50).fill(swatches[swatch].getHex()).move(xStep*colorInd, 0)
        colorInd += 1
      }
    }
});
</script>
</html>
